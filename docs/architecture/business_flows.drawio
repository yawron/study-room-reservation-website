<?xml version="1.0" encoding="UTF-8"?>
<mxfile host="Electron" modified="2024-02-01T00:00:00.000Z" agent="Trae" version="21.0.0" type="device">
  <diagram id="starstudy-flows" name="Business Flows">
    <mxGraphModel dx="1420" dy="860" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1000" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- Header -->
        <mxCell id="title" value="StarStudy 业务流程与状态机" style="text;html=1;align=center;verticalAlign=middle;fontSize=24;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="600" y="20" width="400" height="40" as="geometry"/>
        </mxCell>

        <!-- Section 1: Booking State Machine -->
        <mxCell id="sm_header" value="预订流程状态机 (客户端)" style="text;html=1;align=left;verticalAlign=middle;fontSize=18;fontStyle=1;fillColor=#f5f5f5;strokeColor=#666666;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="80" y="80" width="800" height="40" as="geometry"/>
        </mxCell>

        <mxCell id="state_idle" value="空闲 / 关闭" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;arcSize=50;" vertex="1" parent="1">
          <mxGeometry x="80" y="180" width="120" height="60" as="geometry"/>
        </mxCell>

        <mxCell id="state_step1" value="步骤 1: 选择&#xa;(日期, 时间, 时长)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="300" y="180" width="160" height="60" as="geometry"/>
        </mxCell>

        <mxCell id="state_step2" value="步骤 2: 确认&#xa;(预览 &amp; 支付)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="560" y="180" width="160" height="60" as="geometry"/>
        </mxCell>

        <mxCell id="state_submitting" value="提交中&#xa;(异步操作)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="560" y="320" width="160" height="60" as="geometry"/>
        </mxCell>

        <mxCell id="state_step3" value="步骤 3: 成功&#xa;(确认界面)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;arcSize=10;" vertex="1" parent="1">
          <mxGeometry x="820" y="180" width="160" height="60" as="geometry"/>
        </mxCell>

        <!-- Transitions -->
        <mxCell id="tr_open" value="用户点击 '预订'" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="state_idle" target="state_step1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        
        <mxCell id="tr_next" value="下一步 (输入有效)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="state_step1" target="state_step2">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="tr_back" value="返回" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="state_step2" target="state_step1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="640" y="260"/>
              <mxPoint x="380" y="260"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="tr_confirm" value="确认" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="state_step2" target="state_submitting">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="tr_success" value="API 成功" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="state_submitting" target="state_step3">
          <mxGeometry relative="1" as="geometry">
             <Array as="points">
              <mxPoint x="900" y="350"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="tr_fail" value="错误" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;dashed=1;" edge="1" parent="1" source="state_submitting" target="state_step2">
           <mxGeometry relative="1" as="geometry">
             <Array as="points">
              <mxPoint x="540" y="350"/>
              <mxPoint x="540" y="210"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="tr_close_auto" value="自动关闭 (2秒)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;" edge="1" parent="1" source="state_step3" target="state_idle">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="900" y="140"/>
              <mxPoint x="140" y="140"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Section 2: Detailed Sequence Flow -->
        <mxCell id="flow_header" value="预订时序流 (组件 vs 服务端)" style="text;html=1;align=left;verticalAlign=middle;fontSize=18;fontStyle=1;fillColor=#f5f5f5;strokeColor=#666666;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="80" y="450" width="800" height="40" as="geometry"/>
        </mxCell>

        <!-- Swimlanes -->
        <mxCell id="lane_user" value="用户" style="swimlane;horizontal=0;startSize=40;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="80" y="520" width="840" height="120" as="geometry"/>
        </mxCell>
        <mxCell id="act_click_book" value="点击 '预订房间'" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#b85450;" vertex="1" parent="lane_user">
          <mxGeometry x="60" y="40" width="120" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="act_fill_form" value="选择 日期/时间" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#b85450;" vertex="1" parent="lane_user">
          <mxGeometry x="220" y="40" width="120" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="act_confirm" value="点击 确认" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#b85450;" vertex="1" parent="lane_user">
          <mxGeometry x="380" y="40" width="120" height="40" as="geometry"/>
        </mxCell>

        <mxCell id="lane_client" value="客户端 (BookingModal)" style="swimlane;horizontal=0;startSize=40;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="80" y="640" width="840" height="200" as="geometry"/>
        </mxCell>
        <mxCell id="act_check_auth" value="检查登录?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#6c8ebf;" vertex="1" parent="lane_client">
          <mxGeometry x="400" y="30" width="80" height="80" as="geometry"/>
        </mxCell>
        <mxCell id="act_redirect_login" value="重定向 /login" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="lane_client">
          <mxGeometry x="400" y="140" width="120" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="act_call_server" value="调用服务端 Action&#xa;(submitBookingAction)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#6c8ebf;" vertex="1" parent="lane_client">
          <mxGeometry x="540" y="50" width="140" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="act_show_success" value="显示成功界面" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="lane_client">
          <mxGeometry x="720" y="50" width="100" height="40" as="geometry"/>
        </mxCell>

        <mxCell id="lane_server" value="服务端 (Actions/API)" style="swimlane;horizontal=0;startSize=40;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="80" y="840" width="840" height="120" as="geometry"/>
        </mxCell>
        <mxCell id="act_validate" value="校验 &amp; 保存&#xa;(Cookies/DB)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#9673a6;" vertex="1" parent="lane_server">
          <mxGeometry x="540" y="40" width="140" height="40" as="geometry"/>
        </mxCell>

        <!-- Sequence Connections -->
        <mxCell id="seq_1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="act_click_book" target="act_fill_form">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="seq_2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="act_fill_form" target="act_confirm">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="seq_3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="act_confirm" target="act_check_auth">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="seq_4_no" value="否" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="act_check_auth" target="act_redirect_login">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="seq_4_yes" value="是" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="act_check_auth" target="act_call_server">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="seq_5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="act_call_server" target="act_validate">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="seq_6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="act_validate" target="act_show_success">
          <mxGeometry relative="1" as="geometry">
             <Array as="points">
              <mxPoint x="770" y="860"/>
            </Array>
          </mxGeometry>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>